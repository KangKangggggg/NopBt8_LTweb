<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GraphQL Demo</title>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin-bottom: 30px; padding: 15px; border: 1px solid #ddd; }
        button { margin: 5px; padding: 8px 15px; }
        input, textarea { margin: 5px; padding: 8px; width: 200px; }
        .result { background: #f5f5f5; padding: 10px; margin-top: 10px; }
    </style>
</head>
<body>
    <h1>GraphQL API Demo</h1>
    
    <!-- Hiển thị sản phẩm theo giá -->
    <div class="section">
        <h2>1. Sản phẩm theo giá (thấp đến cao)</h2>
        <button onclick="getProductsOrderByPrice()">Lấy sản phẩm</button>
        <div id="priceResult" class="result"></div>
    </div>
    
    <!-- Sản phẩm theo danh mục -->
    <div class="section">
        <h2>2. Sản phẩm theo danh mục</h2>
        <input type="number" id="categoryId" placeholder="Category ID">
        <button onclick="getProductsByCategory()">Lấy sản phẩm</button>
        <div id="categoryResult" class="result"></div>
    </div>
    
    <!-- CRUD Users -->
    <div class="section">
        <h2>3. Quản lý Users</h2>
        <div>
            <input type="text" id="userFullname" placeholder="Fullname">
            <input type="email" id="userEmail" placeholder="Email">
            <input type="password" id="userPassword" placeholder="Password">
            <input type="text" id="userPhone" placeholder="Phone">
            <button onclick="createUser()">Tạo User</button>
        </div>
        <button onclick="getUsers()">Lấy tất cả Users</button>
        <div id="usersResult" class="result"></div>
    </div>
    
    <!-- CRUD Products -->
    <div class="section">
        <h2>4. Quản lý Products</h2>
        <div>
            <input type="text" id="productTitle" placeholder="Title">
            <input type="number" id="productQuantity" placeholder="Quantity">
            <input type="text" id="productDescription" placeholder="Description">
            <input type="number" id="productPrice" placeholder="Price" step="0.01">
            <input type="number" id="productUserId" placeholder="User ID">
            <button onclick="createProduct()">Tạo Product</button>
        </div>
        <button onclick="getProducts()">Lấy tất cả Products</button>
        <div id="productsResult" class="result"></div>
    </div>
    
    <!-- CRUD Categories -->
    <div class="section">
        <h2>5. Quản lý Categories</h2>
        <div>
            <input type="text" id="categoryName" placeholder="Name">
            <input type="text" id="categoryImages" placeholder="Images URL">
            <button onclick="createCategory()">Tạo Category</button>
        </div>
        <button onclick="getCategories()">Lấy tất cả Categories</button>
        <div id="categoriesResult" class="result"></div>
    </div>

    <script>
        const GRAPHQL_URL = 'http://localhost:8080/graphql';
        
        // Hàm gửi GraphQL query
        async function graphqlQuery(query, variables = {}) {
            try {
                const response = await axios.post(GRAPHQL_URL, {
                    query: query,
                    variables: variables
                });
                return response.data;
            } catch (error) {
                console.error('GraphQL Error:', error);
                return { errors: [error.message] };
            }
        }
        
        // 1. Lấy sản phẩm theo giá
        async function getProductsOrderByPrice() {
            const query = `
                query {
                    productsOrderByPrice {
                        id
                        title
                        price
                        quantity
                        description
                        user {
                            fullname
                            email
                        }
                    }
                }
            `;
            
            const result = await graphqlQuery(query);
            document.getElementById('priceResult').innerHTML = 
                '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
        }
        
        // 2. Lấy sản phẩm theo danh mục
        async function getProductsByCategory() {
            const categoryId = document.getElementById('categoryId').value;
            const query = `
                query($categoryId: ID!) {
                    productsByCategory(categoryId: $categoryId) {
                        id
                        title
                        price
                        quantity
                        description
                    }
                }
            `;
            
            const result = await graphqlQuery(query, { categoryId });
            document.getElementById('categoryResult').innerHTML = 
                '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
        }
        
        // 3. CRUD Users
        async function createUser() {
            const fullname = document.getElementById('userFullname').value;
            const email = document.getElementById('userEmail').value;
            const password = document.getElementById('userPassword').value;
            const phone = document.getElementById('userPhone').value;
            
            const query = `
                mutation($fullname: String!, $email: String!, $password: String!, $phone: String!) {
                    createUser(fullname: $fullname, email: $email, password: $password, phone: $phone) {
                        id
                        fullname
                        email
                        phone
                    }
                }
            `;
            
            const result = await graphqlQuery(query, { fullname, email, password, phone });
            alert('User created successfully!');
            getUsers();
        }
        
        async function getUsers() {
            const query = `
                query {
                    users {
                        id
                        fullname
                        email
                        phone
                        products {
                            title
                            price
                        }
                    }
                }
            `;
            
            const result = await graphqlQuery(query);
            document.getElementById('usersResult').innerHTML = 
                '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
        }
        
        // 4. CRUD Products
        async function createProduct() {
            const title = document.getElementById('productTitle').value;
            const quantity = parseInt(document.getElementById('productQuantity').value);
            const description = document.getElementById('productDescription').value;
            const price = parseFloat(document.getElementById('productPrice').value);
            const userId = parseInt(document.getElementById('productUserId').value);
            
            const query = `
                mutation($title: String!, $quantity: Int!, $description: String!, $price: Float!, $userId: ID!) {
                    createProduct(title: $title, quantity: $quantity, description: $description, price: $price, userId: $userId) {
                        id
                        title
                        price
                        quantity
                        description
                    }
                }
            `;
            
            const result = await graphqlQuery(query, { title, quantity, description, price, userId });
            alert('Product created successfully!');
            getProducts();
        }
        
        async function getProducts() {
            const query = `
                query {
                    products {
                        id
                        title
                        price
                        quantity
                        description
                        user {
                            fullname
                            email
                        }
                    }
                }
            `;
            
            const result = await graphqlQuery(query);
            document.getElementById('productsResult').innerHTML = 
                '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
        }
        
        // 5. CRUD Categories
        async function createCategory() {
            const name = document.getElementById('categoryName').value;
            const images = document.getElementById('categoryImages').value;
            
            const query = `
                mutation($name: String!, $images: String) {
                    createCategory(name: $name, images: $images) {
                        id
                        name
                        images
                    }
                }
            `;
            
            const result = await graphqlQuery(query, { name, images });
            alert('Category created successfully!');
            getCategories();
        }
        
        async function getCategories() {
            const query = `
                query {
                    categories {
                        id
                        name
                        images
                        products {
                            title
                            price
                        }
                    }
                }
            `;
            
            const result = await graphqlQuery(query);
            document.getElementById('categoriesResult').innerHTML = 
                '<pre>' + JSON.stringify(result, null, 2) + '</pre>';
        }
    </script>
</body>
</html>